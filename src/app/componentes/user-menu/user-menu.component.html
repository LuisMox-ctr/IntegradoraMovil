<!-- Avatar clickeable en el header -->
<div class="user-menu-trigger" (click)="abrirMenu($event)">
  <img 
    [src]="usuario?.foto || usuario?.avatar || 'assets/img/default-avatar.png'" 
    alt="Avatar"
    class="user-avatar">
  <div class="status-indicator"></div>
</div>

<!-- Popover Menu -->
<ion-popover 
  #popover 
  [isOpen]="isMenuOpen" 
  (didDismiss)="cerrarMenu()"
  side="bottom"
  alignment="end">
  <ng-template>
    <ion-content class="user-menu-content">
      <!-- Header del menú con info del usuario -->
      <div class="menu-header">
        <img 
          [src]="usuario?.foto || usuario?.avatar || 'assets/img/default-avatar.png'" 
          alt="Avatar"
          class="menu-avatar">
        <div class="menu-user-info">
          <h3>{{ usuario?.nombre || 'Usuario' }}</h3>
          <p *ngIf="usuario?.username">@{{ usuario?.username }}</p>
          <div class="user-stats">
            <span class="stat-badge">
              <ion-icon name="trophy"></ion-icon>
              {{ usuario?.puntos || 0 }}
            </span>
            <span class="stat-badge">
              <ion-icon name="ribbon"></ion-icon>
              {{ usuario?.logrosCompletados || 0 }}
            </span>
          </div>
        </div>
      </div>

      <!-- Opciones del menú -->
      <ion-list class="menu-list">
        <ion-item button (click)="irAPerfil()" class="menu-item">
          <ion-icon name="person-outline" slot="start"></ion-icon>
          <ion-label>Mi Perfil</ion-label>
        </ion-item>

        <ion-item button (click)="irALogros()" class="menu-item">
          <ion-icon name="trophy-outline" slot="start"></ion-icon>
          <ion-label>Mis Logros</ion-label>
          <ion-badge slot="end" color="warning">{{ usuario?.logrosCompletados || 0 }}</ion-badge>
        </ion-item>
        <!-- Separador -->
        <div class="menu-separator"></div>

        <ion-item button (click)="cerrarSesion()" class="menu-item logout-item">
          <ion-icon name="log-out-outline" slot="start" color="danger"></ion-icon>
          <ion-label color="danger">Cerrar Sesión</ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>