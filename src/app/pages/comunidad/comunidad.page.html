<!-- ============================================ -->
<!-- comunidad.page.html -->
<!-- CAMBIOS OPCIONALES - Para mostrar foto o avatar -->
<!-- ============================================ -->

<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <ion-icon name="people" class="title-icon"></ion-icon>
      COMUNIDAD V MAGMA
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Header con selector de pestañas -->
  <div class="community-tabs">
    <button class="tab-btn" 
            [class.active]="vistaActual === 'ranking'" 
            (click)="cambiarVista('ranking')">
      <ion-icon name="podium"></ion-icon>
      <span>Ranking</span>
    </button>
    <button class="tab-btn" 
            [class.active]="vistaActual === 'actividad'" 
            (click)="cambiarVista('actividad')">
      <ion-icon name="flame"></ion-icon>
      <span>Actividad</span>
    </button>
    <button class="tab-btn" 
            [class.active]="vistaActual === 'eventos'" 
            (click)="cambiarVista('eventos')">
      <ion-icon name="calendar"></ion-icon>
      <span>Eventos</span>
    </button>
  </div>

  <!-- VISTA: RANKING -->
  <div class="vista-ranking" *ngIf="vistaActual === 'ranking'">
    <div class="podium-container">
      <h2 class="section-title">TOP SOBREVIVIENTES</h2>
      
      <!-- Podio Top 3 -->
      <div class="podium">
        <!-- Segundo lugar -->
        <div class="podium-place second" *ngIf="ranking[1]">
          <div class="crown silver">
            <ion-icon name="medal"></ion-icon>
          </div>
          <div class="player-avatar">
            <!-- CAMBIO: Usa el helper para obtener foto o avatar -->
            <img [src]="ranking[1].foto || ranking[1].avatar" 
                 [alt]="ranking[1].username">
          </div>
          <!-- CAMBIO: Puedes mostrar nombre completo -->
          <h3>{{ ranking[1].username }}</h3>
          <p class="points">{{ ranking[1].puntos }} pts</p>
          <div class="rank-number">2</div>
        </div>

        <!-- Primer lugar -->
        <div class="podium-place first" *ngIf="ranking[0]">
          <div class="crown gold">
            <ion-icon name="trophy"></ion-icon>
          </div>
          <div class="player-avatar">
            <img [src]="ranking[0].foto || ranking[0].avatar" 
                 [alt]="ranking[0].nombre">
          </div>
          <h3>{{ ranking[0].username }}</h3>
          <p class="points">{{ ranking[0].puntos }} pts</p>
          <div class="rank-number">1</div>
        </div>

        <!-- Tercer lugar -->
        <div class="podium-place third" *ngIf="ranking[2]">
          <div class="crown bronze">
            <ion-icon name="medal"></ion-icon>
          </div>
          <div class="player-avatar">
            <img [src]="ranking[2].foto || ranking[2].avatar" 
                 [alt]="ranking[2].nombre">
          </div>
          <h3>{{ ranking[2].nombre }} {{ ranking[2].apellidos || '' }}</h3>
          <p class="points">{{ ranking[2].puntos }} pts</p>
          <div class="rank-number">3</div>
        </div>
      </div>

      <!-- Resto del ranking -->
      <div class="ranking-list">
        <ion-card *ngFor="let jugador of ranking.slice(3); let i = index" class="player-card">
          <div class="rank-badge">{{ i + 4 }}</div>
          <div class="player-info">
  <img [src]="jugador.foto || jugador.avatar" [alt]="jugador.nombre" class="avatar-small">
  <div class="info">
    <h4>{{ jugador.nombre }} {{ jugador.apellidos || '' }}</h4>
    <p>
      <ion-icon name="trophy"></ion-icon>
      {{ contarLogrosReales(jugador) }} logros
    </p>
    
    <!-- ✨ NUEVO: Mostrar lista de logros -->
    <div class="logros-mini" *ngIf="getLogrosUsuario(jugador).length > 0">
      <ion-chip *ngFor="let logro of getLogrosUsuario(jugador).slice(0, 3)">
        <ion-icon name="trophy"></ion-icon>
        <ion-label>{{ logro.titulo }}</ion-label>
      </ion-chip>
    </div>
  </div>
</div>
          <div class="player-points">
            <span class="points-value">{{ jugador.puntos }}</span>
            <span class="points-label">pts</span>
          </div>
        </ion-card>
      </div>
    </div>
  </div>

  <!-- VISTA: ACTIVIDAD RECIENTE -->
<div class="vista-actividad" *ngIf="vistaActual === 'actividad'">
  <div class="actividad-container">
    <h2 class="section-title">ACTIVIDAD RECIENTE</h2>
    
    <ion-card *ngFor="let actividad of actividadReciente" class="actividad-card">
      <div class="actividad-icon" [class]="'icon-' + actividad.tipo">
        <ion-icon [name]="getIconoActividad(actividad.tipo)"></ion-icon>
      </div>
      
      <div class="actividad-content">
        <div class="actividad-header">
          <!-- ✅ Usar helpers para jugador -->
          <img [src]="getAvatarJugador(actividad)" 
               [alt]="getNombreJugador(actividad)" 
               class="avatar-tiny">
          <span class="jugador-nombre">{{ getNombreJugador(actividad) }}</span>
          <span class="tiempo">{{ actividad.tiempo }}</span>
        </div>
        
        <p class="actividad-texto">{{ actividad.descripcion }}</p>
        
        <!-- ✅ Logros con helpers -->
        <div class="actividad-extra" *ngIf="tieneLogro(actividad)">
          <div class="logro-mini">
            <img [src]="getLogroIcono(actividad)" alt="">
            <span>{{ getLogroTitulo(actividad) }}</span>
          </div>
        </div>
      </div>
    </ion-card>
  </div>
</div>


  <!-- VISTA: EVENTOS - Sin cambios -->
  <div class="vista-eventos" *ngIf="vistaActual === 'eventos'">
    <div class="eventos-container">
      <h2 class="section-title">EVENTOS ACTIVOS</h2>
      
      <ion-card *ngFor="let evento of eventos" class="evento-card">
        <div class="evento-badge" [class]="'badge-' + evento.tipo">
          {{ evento.tipo }}
        </div>
        
        <ion-card-header>
          <ion-card-title class="evento-titulo">
            <ion-icon [name]="evento.icono"></ion-icon>
            {{ evento.nombre }}
          </ion-card-title>
          <ion-card-subtitle class="evento-fecha">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ evento.fecha }}
          </ion-card-subtitle>
        </ion-card-header>
        
        <ion-card-content>
          <p class="evento-descripcion">{{ evento.descripcion }}</p>
          
          <div class="evento-recompensa">
            <ion-icon name="gift"></ion-icon>
            <span>Recompensa: {{ evento.recompensa }}</span>
          </div>
          
          <div class="evento-participantes">
            <ion-icon name="people"></ion-icon>
            <span>{{ evento.participantes }} participantes</span>
          </div>
          
          <ion-button expand="block" class="btn-participar">
            <ion-icon slot="start" name="flag"></ion-icon>
            PARTICIPAR
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>